checkout:
  post:
    - '[[ ! -e "$(git rev-parse --git-dir)/shallow" ]] || git fetch --unshallow'

dependencies:
  override:
    - pip install -r requirements.txt:
        pwd: server/tests

    - npm install -g gulp
    - npm install:
        pwd: client
    - bower install:
        pwd: client

  cache_directories:
    - client/node_modules
    - client/bower_components

machine:
  environment:
    # APP_ENV: test
  artifacts:
    - somedir
    - "some,file"

test:
  override:
    - python run_tests.py:
        pwd: server

    - gulp compile:
        pwd: client
    # - 'if [ "$CIRCLE_BRANCH" = client -o "$CIRCLE_BRANCH" = master ]; then gulp compile; else gulp build; fi':
    #     pwd: client

  post:
    - mkdir somedir
    - date > "somedir/foo,bar"
    - ls -al somedir
    - date > "some,file"
    - ls -la


